# mass-alligator

Утилита для пакетной загрузки релизов на сервис MusicAlligator. Программа читает пресеты из `config.yaml` и загружает пары файлов PNG и WAV. Для каждого найденного дуэта создаётся черновик релиза, после чего метаданные трека заполняются автоматически.

## Использование

1. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```
2. Запустите веб-интерфейс:

   ```bash
   python -m streamlit run app.py
   ```

3. При первом запуске введите токен авторизации в боковой панели. Если `config.yaml` отсутствует, он будет создан автоматически.
   Выберите артистов, которых хотите настроить, в списке **Artists**.

4. Перетащите WAV и PNG файлы на страницу. Названия пар должны совпадать (например, `Artist - Title.wav` и `Artist - Title.png`). Проверьте найденные релизы, при необходимости отметьте *Explicit* и дату трека, затем запустите загрузку.

Приложение отправляет запросы к API MusicAlligator, чтобы создать черновик, установить лейбл, загрузить обложку и аудио, а затем обновить метаданные трека (год записи, язык, композиторы и авторы текста).

### Последовательность работы

Для каждой пары файлов выполняются шаги:

1. **Создание черновика** – `POST /api/releases/create` с полем `releaseType=SINGLE`.
2. **Обновление основных метаданных** – `PUT /api/releases/{id}` с названием, датами, основным артистом и жанром.
3. **Установка лейбла** – `PUT /api/releases/{id}` с `labelId`, а также полями `clineValue`, `clineYear`, `plineValue`, `plineYear` из пресета артиста.
4. **Загрузка обложки** – `POST /api/releases/{id}/cover` с PNG файлом.
5. **Загрузка аудио** – `POST /api/releases/{id}/tracks/{tid}/upload` с WAV файлом.
6. **Обновление метаданных трека** – `PUT /api/releases/{id}/tracks/{tid}` с годом записи, языком, композиторами, авторами текста и флагом Explicit.

## Файл конфигурации

```yaml
auth_token: YOUR_TOKEN
artists:
  My Artist: 12345
labels:
  My Label: 67890
presets:
  My Artist:
    label_id: 67890
    genre_id: 196
    recording_year: 2024
    language_id: 7
    composers: []
    lyricists: []
```

Поле `label_id` связывает артиста с его лейблом. Остальные поля не обязательны. Флажок Explicit и дата трека задаются вручную в интерфейсе.
Список композиторов и авторов текста подгружается автоматически, достаточно выбрать нужные имена из выпадающего списка.

## Справочник API

Все запросы выполняются на `https://v2api.musicalligator.com` и требуют заголовок `Authorization` с токеном сессии.

### Аутентификация

**Тип запроса:** `GET`

**URL:** `/api/auth/authenticate`

| Параметр | Тип | Описание |
|---------|------|----------|
| — | — | Только заголовок `Authorization` |

### Поиск артистов

**Тип запроса:** `GET`

**URL:** `/api/artists`

| Параметр | Тип | Описание |
|---------|------|----------|
| `name` | string | Строка поиска по имени артиста |

### Список лейблов

**Тип запроса:** `GET`

**URL:** `/api/labels`

| Параметр | Тип | Описание |
|---------|------|----------|
| `_status` | string | Значение `READY` |
| `level` | string | Например, `REGULAR` |
| `skip` | integer | Смещение выдачи |
| `limit` | integer | Количество элементов |

### Создание черновика

**Тип запроса:** `POST`

**URL:** `/api/releases/create`

| Параметр | Тип | Описание |
|---------|------|----------|
| `releaseType` | string | Тип релиза (обычно `SINGLE`) |

### Получение релиза

**Тип запроса:** `GET`

**URL:** `/api/releases/{releaseId}`

| Параметр | Тип | Описание |
|---------|------|----------|
| `releaseId` | integer | Идентификатор релиза в пути |

### Обновление релиза

**Тип запроса:** `PUT`

**URL:** `/api/releases/{releaseId}`

| Параметр | Тип | Описание |
|---------|------|----------|
| `title` | string | Название релиза |
| `releaseDate` | string | Дата выхода `YYYY-MM-DD` |
| `originalReleaseDate` | string | Первоначальная дата релиза |
| `clineYear` | string | Год права C |
| `clineValue` | string | Правообладатель C |
| `plineYear` | string | Год права P |
| `plineValue` | string | Правообладатель P |
| `status` | string | Статус, например `DRAFT` |
| `client.id` | integer | ID клиента (артиста) |
| `labelId` | integer | ID лейбла |
| `genres` | array | Список жанров `{genreId}` |
| `tracks` | array | Список треков `{trackId}` |
| `streamingPlatforms` | array | ID платформ |
| `countries` | array | Ограничения по странам |

### Загрузка обложки

**Тип запроса:** `POST`

**URL:** `/api/releases/{releaseId}/cover`

| Параметр | Тип | Описание |
|---------|------|----------|
| `file` | file | PNG-файл обложки (multipart) |

### Загрузка аудио

**Тип запроса:** `POST`

**URL:** `/api/releases/{releaseId}/tracks/{trackId}/upload`

| Параметр | Тип | Описание |
|---------|------|----------|
| `file` | file | WAV-файл аудио (multipart) |

### Выбор платформ

**Тип запроса:** `PUT`

**URL:** `/api/releases/{releaseId}/platforms`

| Параметр | Тип | Описание |
|---------|------|----------|
| `platformIds` | array | Список ID платформ |

### Обновление трека

**Тип запроса:** `PUT`

**URL:** `/api/tracks/{trackId}`

| Параметр | Тип | Описание |
|---------|------|----------|
| `recordingYear` | integer | Год записи |
| `language` | integer | ID языка |
| `composers` | array | ID композиторов |
| `lyricists` | array | ID авторов текста |

### Список платформ

**Тип запроса:** `GET`

**URL:** `/api/platform/platforms/streaming`

| Параметр | Тип | Описание |
|---------|------|----------|
| `withProvidersOnly` | boolean | Только платформы с провайдерами |

*Документация основана на перехваченных запросах и может быть неполной.*
